script 'chef-server-upload' do
  interpreter 'bash'
  code <<-KNIFE
  knife cookbook upload dvwa vicnum webgoat gruyere bricks apache2 mysql mysql2_chef_gem postgresql php database java build-essential mariadb compat_resource openssl yum-epel apt windows homebrew seven_zip mingw selinux_policy yum-scl yum ohai inifile_chef_gem hostname hostsfile pentest-env network_interfaces resolver ssh_authorized_keys docker cron kube etcd modules
KNIFE
end

execute 'knife environment create wargames --disable-editing'
directory '/root/.chef/nodes'
%w[workstation dvwa gruyere webgoat bricks vicnum].each do |n|
  cookbook_file "/root/.chef/nodes/#{n}.json" do
    source "chef-env/nodes/#{n}.json"
  end
end
execute 'knife node from file /root/.chef/nodes/*.json'
